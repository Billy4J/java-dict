<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.afterAll.mybatis.mapper.ResultMapper">

    <resultMap id="mapName" type="Group">
        <id property="gid" column="gid"/>
        <result property="gName" column="g_name"/>
        <result property="gAddress" column="g_address"/>
    </resultMap>

    <select id="getGroupLikeUseResultMap" resultMap="mapName">
        select *
        from t_group
        where g_name like "%"#{feat}"%"
    </select>

    <select id="getGroupLikeBySql1Alias" resultType="Group">
        select gid, g_name gName, g_address gAddress
        from t_group
        where g_name like "%"#{feat}"%"
    </select>

    <select id="getGroupLikeBySetting" resultType="Group">
        select *
        from t_group
        where g_name like "%"#{feat}"%"
    </select>


    <!--使用级联赋值方式，同名列需要给定别名来区分-->
    <resultMap id="userGroupMap" type="User">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="birthday" column="birthday"/>
        <result property="group.gid" column="gid"/>
        <result property="group.gName" column="g_name"/>
    </resultMap>

    <select id="getUserById" resultMap="userGroupMap">
        select u.*, g.*
        from t_user u
                 join t_group g on u.gid = g.gid
        where u.id = #{id}
    </select>


    <!--使用association处理映射关系-->
    <resultMap id="userGroupMap2" type="User">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="birthday" column="birthday"/>
        <association property="group" javaType="Group">
            <id property="gid" column="gid"/>
            <result property="gName" column="g_name"/>
        </association>
    </resultMap>


    <select id="getUserById2" resultMap="userGroupMap2">
        select *
        from t_user
                 left join t_group on t_user.gid = t_group.gid
        where t_user.id = #{id}
    </select>


    <!--分步查询: 先查询user，在查询gid对应的group-->
    <resultMap id="userGroupMap3" type="User">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="birthday" column="birthday"/>
        <!--
        select：设置分步查询，查询某个属性的值的sql的标识（namespace.sqlId）
        column：将sql以及查询结果中的某个字段设置为分步查询的条件
        -->
        <association property="group" select="com.afterAll.mybatis.mapper.ResultMapper.getGroupById" column="gid"/>
    </resultMap>

    <select id="getUserById3" resultMap="userGroupMap3">
        select *
        from t_user
        where t_user.id = #{id}
    </select>

    <resultMap id="groupMap" type="Group">
        <id property="gid" column="gid"/>
        <result property="gName" column="g_name"/>
    </resultMap>

    <select id="getGroupById" resultMap="groupMap">
        select *
        from t_group
        where gid = #{gid}
    </select>


    <!---->
    <resultMap id="groupUserMap" type="Group">
        <id property="gid" column="gid"/>
        <result property="gName" column="g_name"/>
        <collection property="users" ofType="User">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="birthday" column="birthday"/>
        </collection>
    </resultMap>

    <select id="getGroupUsersById" resultMap="groupUserMap">
        select *
        from t_group
                 left join t_user on t_group.gid = t_user.gid
        where t_group.gid = #{gid};
    </select>


    <!---->
    <resultMap id="groupUserMap2" type="Group">
        <id property="gid" column="gid"/>
        <result property="gName" column="g_name"/>
        <collection property="users" select="getUserByGid" column="gid">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="birthday" column="birthday"/>
        </collection>
    </resultMap>

    <select id="getGroupUsersById2" resultMap="groupUserMap2">
        select *
        from t_group
        where gid = #{gid}
    </select>

    <select id="getUserByGid" resultType="User">
        select *
        from t_user
        where gid = #{gid};
    </select>

</mapper>


